# Railsのマイグレーションって何？

## ✅ 行ったこと

- マイグレーションについて調べた

## マイグレーションとは

- データベースを完成させるには、テーブルを作成したり、カラムを追加したりと、1つ1つのステップを踏む必要があると言いました。<br>
このステップを踏んでデータベースを完成させることを マイグレーション といいます。[1]

- テーブルを操作するには、SQL を実行する必要があります。<br>
しかしRailsでは マイグレーション という仕組みのおかげで、 Ruby でテーブル操作を行うことが可能です。<br>
マイグレーションとは マイグレーションファイル を元に テーブル操作 を行う仕組みです。<br>
マイグレーションファイルとは、Rubyで書かれた テーブルの設計図 のことです。<br>
テーブルの設計図とは カラム や データ型 の定義が書かれた状態のことを指します。[2]

- まずDBを作るときに、何という名前のテーブルがあって、そのテーブルにはどういう型の何という名前のカラムがあるかといった情報が必要になるかと思います。<br>
それらの情報をマイグレーションファイルというファイルに書き込みます。つまりマイグレーションファイルとはDBの設計図になります。<br>
そしてこのマイグレーションファイルに記述された内容を元に、テーブルの作成やカラムの追加・削除などの操作を行うことをマイグレーション（マイグレーション実行）と言います。[3]


## マイグレーションで実現できること[2]
ここで勘違いしないで頂きたいのは マイグレーションはテーブルを作成する機能だけではない ということです。<br>
マイグレーションは主に以下のことが実現できます。

- テーブル作成
- テーブル削除
- カラム追加
- カラム名変更
- カラムのデータ型変更
- カラム削除

先ほどマイグレーションの定義として**テーブルに関する操作**と述べたのは、このような理由からです。

## up・downについて[3]

実際の結果を見た方が早いと思うので、ターミナルで以下のように打ってみます。<br>

```
rails db:migrate:status
```

上記のコマンドを実行すると以下のように返ってきました。（記号の部分はクラス名です）

```
Status  Migration ID  Migration Name
----------------------------------------------------
up   2024020905247 Create 〇〇
up   20240223015331 Rename △△
up   20240407072621 Create □□
down  20240409042306 Create ◇◇
```

これはそれぞれのマイグレーションファイルのステータスをup・downと共に一覧で表してくれています。<br>
このup・downが何を意味かしているかというと、マイグレーションファイルがDBに反映済みであるか、そうでないかを表しています。<br>
反映済みであればup、そうでなければdownが表示されます。 <br>
上記の例で言うと一番下のマイグレーションファイルがDBに反映されていないということになります。

## つまり、マイグレーションとは

マイグレーションは、データベースのスキーマ（構造）を段階的に変更・管理できるRailsの仕組みです。<br>
1つの変更内容は「マイグレーションファイル」に記述され、rails db:migrate コマンドで未適用の変更をデータベースに反映できます。<br>
マイグレーションファイルでは、変更処理をup、元に戻す処理をdownとして定義することができ、ロールバックにも対応しています。<br>
この仕組みによって、チーム開発でもデータベースの構造を安全に共有・統一でき、本番環境への反映もスムーズに行えます。

## 参考サイト
[1](https://qiita.com/Arashi-K/items/4e26fd367847b8bbed18)<br>
[2](https://diveintocode.jp/blogs/Technology/migration)<br>
[3](https://www.divx.co.jp/media/164#66a8a08061064a096a31df40-1722396045220)<br>