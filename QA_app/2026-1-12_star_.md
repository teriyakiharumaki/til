# ä¸€è¦§ç”»é¢ã«ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã‚’å®Ÿè£…

## âœ… è¡Œã£ãŸã“ã¨

- ä¸€è¦§ç”»é¢ã«ã‚ã‚‹å„å•é¡Œã«ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã‚’å®Ÿè£…

## å®Ÿéš›ã®æµã‚Œ

### â‘ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
config/routes.rb
```
resources :questions do
  member do
    patch :toggle_star
  end
end
```
- questions ã«å¯¾ã—ã¦ 1ä»¶ï¼ˆmemberï¼‰å°‚ç”¨ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ toggle_star ã‚’è¿½åŠ 

  ã§ãã‚ãŒã‚‹URLï¼šPATCH /questions/:id/toggle_star

- patchã¯ã€ã€Œã“ã®URLã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ã¨ã‚µãƒ¼ãƒãƒ¼ã«ä¼ãˆã‚‹

#### ç–‘å•ï¼špatchãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯updateãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ï¼Ÿ
ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒˆãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹
```
PATCH /questions/:id/toggle_star â†’ questions#toggle_star
```
updateãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ãã€
```
PATCH /questions/:id â†’ questions#update
```
åŒã˜ PATCH ã§ã‚‚ã€ãƒ‘ã‚¹ãŒé•ãˆã°å‘¼ã°ã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒé•ã†

#### å‚è€ƒã«ãªã‚‹ã‚µã‚¤ãƒˆ
member â†’ https://qiita.com/hirokihello/items/fa82863ab10a3052d2ff#member%E3%81%AE%E7%89%B9%E5%BE%B4<br>
patch â†’ https://qiita.com/void_takazu/items/746edef2136143343b3f

### â‘¡controllerã«toggleã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨˜è¿°
```
def toggle_star
  @question = Question.find(params[:id])
  @question.update!(is_starred: !@question.is_starred)

  respond_to do |format|
    format.turbo_stream
    format.html { redirect_to questions_path, notice: "æ›´æ–°ã—ã¾ã—ãŸ" }
  end
end
```
- `@question = Question.find(params[:id])`

  URL ã® :id ã‚’ä½¿ã£ã¦ã€å¯¾è±¡ã® Question ã‚’1ä»¶å–å¾—ã—ã¦ã„ã‚‹<br>
  ãŸã¨ãˆã°ï¼š
  ```
  PATCH /questions/12/toggle_star
  ```
  ã ã£ãŸã‚‰ï¼š
  ```
  params[:id] #=> "12"
  ```
  ã«ãªã£ã¦ã€
  ```
  Question.find(12)
  ```
  ãŒå®Ÿè¡Œã•ã‚Œã‚‹<br>
  ã¤ã¾ã‚Šï¼šã€Œ12ç•ªã®å•é¡Œã‚’ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆå¯¾è±¡ã«ã™ã‚‹ã€

- `@question.update!(is_starred: !@question.is_starred)`

  ğŸ”¹ `@question.is_starred`ï¼šç¾åœ¨ã®å€¤ï¼ˆtrue ã‹ falseï¼‰<br>
  ğŸ”¹ `!@question.is_starred`ï¼š!ãŒã¤ã„ã¦ã„ã¦è«–ç†å¦å®šã«ãªã‚‹
  ğŸ”¹ `update!`ï¼šDBã«ä¿å­˜ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€!ãŒã¤ã„ã¦ã„ã‚‹ã“ã¨ã§å¤±æ•—ã—ãŸã‚‰ä¾‹å¤–ã‚’æŠ•ã’ã‚‹

- `respond_to do |format| ... end`

  ğŸŒ€`format.turbo_stream`ï¼›Turbo ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã ã£ãŸå ´åˆã€Railsã¯è‡ªå‹•ã§ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã™
  ```
  app/views/questions/toggle_star.turbo_stream.erb
  ```
  ãã—ã¦ã€ãã®ä¸­èº«ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã™

  ğŸŒ`format.html { redirect_to ... }`ï¼šTurbo ãŒç„¡åŠ¹ã ã£ãŸå ´åˆã®ä¿é™º

### â‘¢æ˜Ÿéƒ¨åˆ†ã‚’partialã«åˆ‡ã‚Šå‡ºã™
app/views/questions/_star.html.erb
```
<%= turbo_frame_tag dom_id(question, :star) do %>
  <%= link_to toggle_star_question_path(question),
              data: { turbo_method: :patch },
              class: "inline-flex items-center" do %>
    <% if question.is_starred? %>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
        <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z" clip-rule="evenodd" />
      </svg>
    <% else %>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z" />
      </svg>
    <% end %>
  <% end %>
<% end %>
```
- `turbo_frame_tag dom_id(question, :star) do`

  ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ï¼šã€Œã“ã®éƒ¨åˆ†ã¯Turbo Frameã§ã™ã‚ˆã€ã¨ã„ã†æ ã‚’ä½œã£ã¦ã„ã‚‹<br>
  ãªãœå¿…è¦ï¼šTurbo Streamã® replace ã¯ã€ã€Œid ãŒâ—‹â—‹ã®è¦ç´ ã‚’å·®ã—æ›¿ãˆã‚‹ã€ã¨ã„ã†å‘½ä»¤ã ã‹ã‚‰ã€å·®ã—æ›¿ãˆå¯¾è±¡ã®idã‚’æŒã£ãŸâ€œå…¥ã‚Œç‰©â€ãŒå¿…è¦ã«ãªã‚‹<br>
  ã“ã® turbo-frame ãŒã€ãã®å…¥ã‚Œç‰©ã«ãªã‚‹

  - `dom_id(question, :star)`

    ä½•ã‚’ã—ã¦ã‚‹ã®ã‹ï¼šRailsã® helper ã§ã€ä¸€æ„ãªDOM idæ–‡å­—åˆ—ã‚’ä½œã‚‹<br>
    ãŸã¨ãˆã°ï¼šquestion.id = 12 ã®ã¨ãâ†’ "question_12_star"

    ãªãœ :star ã‚’ä»˜ã‘ã‚‹ã®ã‹ï¼šåŒã˜ question ã§ã‚‚ã€ãƒšãƒ¼ã‚¸å†…ã§æ›´æ–°ã—ãŸã„éƒ¨å“ãŒä»–ã«ã‚‚ã‚ã‚Šãˆã‚‹ã‹ã‚‰<br>
    ãŸã¨ãˆã°ï¼š
    - æ˜Ÿç”¨ â†’ question_12_star
    - ã‚¿ã‚¤ãƒˆãƒ«ç”¨ â†’ question_12_title
    - å›ç­”ç”¨ â†’ question_12_answer

    ã¿ãŸã„ã«ã€åŒã˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã§ã‚‚æ›´æ–°å¯¾è±¡ã‚’åˆ†ã‘ã‚‰ã‚Œã‚‹ã€‚

- `link_to toggle_star_question_path(question), ... do`

  ä½•ã‚’ã—ã¦ã‚‹ã®ã‹ï¼šæ˜Ÿï¼ˆSVGï¼‰ã‚’ãƒªãƒ³ã‚¯ã«ã—ã¦ã„ã‚‹

  - `toggle_star_question_path(question)`

    ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ï¼šoutes.rb ã§å®šç¾©ã—ãŸã“ã®ãƒ«ãƒ¼ãƒˆâ†’patch :toggle_starã«å¯¾å¿œã™ã‚‹URLã‚’ä½œã£ã¦ã‚‹<br>
    ä¾‹ï¼ˆid=12ï¼‰ï¼š/questions/12/toggle_star

  - `data: { turbo_method: :patch }`

    ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ï¼š`<a>` ã‚¿ã‚°ã¯æœ¬æ¥ GET ã—ã‹ã§ããªã„ã‘ã©ã€Turbo ãŒã“ã®å±æ€§ã‚’è¦‹ã¦ã€ã€Œã“ã‚Œã¯PATCHã§é€ã‚‹ãƒªãƒ³ã‚¯ãªã‚“ã ãªã€ã¨åˆ¤æ–­ã—ã¦ã€PATCHãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦é€ã£ã¦ãã‚Œã‚‹

#### â“`toggle_star_question_path(question)`ã®éƒ¨åˆ†ã«ã¤ã„ã¦ã€ã©ã†ã„ã†ã“ã¨ã‹ã‚ã‘ãŒã‚ã‹ã‚‰ã‚“ã§
ã“ã†åˆ†ã‘ã‚‰ã‚Œã‚‹
```
[ãƒ«ãƒ¼ãƒˆå]        [ç¨®é¡]
toggle_star_question  _path
```
- `toggle_star_question`ã®éƒ¨åˆ†ã¯ã€ã€Œãƒ«ãƒ¼ãƒˆã®åå‰ã€ï¼ˆã“ã‚Œã¯ routes.rb ã§ Rails ãŒè‡ªå‹•çš„ã«ã¤ã‘ãŸåå‰ï¼‰

  routesï¼š
  ```
  resources :questions do
    member do
      patch :toggle_star
    end
  end
  ```
  ã“ã‚Œã‹ã‚‰ Rails ã¯ã€æ¬¡ã®ãƒ«ãƒ¼ãƒ«ã§åå‰ã‚’ä½œã‚‹ï¼š
  ```
  [action]_[resource(å˜æ•°)]
  ```
  ã ã‹ã‚‰ï¼š
  - action â†’ toggle_star
  - resource â†’ questionï¼ˆmember ãªã®ã§å˜æ•°ï¼‰

  çµ„ã¿åˆã‚ã›ã¦ï¼š
  ```
  toggle_star_question
  ```
  ã«ãªã‚‹ã®ã§ã€ğŸ‘‰ ã“ã®éƒ¨åˆ†ã¯ã€ŒURLã®æ„å‘³ã‚’è¡¨ã™åå‰ã€

- `_path`ã®éƒ¨åˆ†ã¯ã€ã€Œä½•ã‚’è¿”ã™ã‹ã®æŒ‡å®šã€

  Railsã®ãƒ«ãƒ¼ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ã®ç¨®é¡ã¯äºŒç¨®é¡
  - ç¨®é¡ï¼šè¿”ã™ã‚‚ã®
  - _pathï¼š/questions/12/toggle_starï¼ˆç›¸å¯¾ãƒ‘ã‚¹ï¼‰
  - _urlï¼š`http://localhost:3000/questions/12/toggle_starï¼ˆå®Œå…¨URLï¼‰`

- ã¾ã¨ã‚

  ```
  toggle_star_question_path(question)
  â”‚
  â”œâ”€ toggle_star_question â†’ ã©ã®ãƒ«ãƒ¼ãƒˆã‹
  â”œâ”€ _path               â†’ ãƒ‘ã‚¹ã‚’è¿”ã™
  â””â”€ (question)          â†’ :id ã«å…¥ã‚Œã‚‹å¯¾è±¡

  ```
  (question) ã‚’æ¸¡ã™ã“ã¨ã§ï¼š
  ```
  /questions/:id/toggle_star
  ```
  ã® :id ã« question.id ãŒè‡ªå‹•ã§å…¥ã‚‹

### â‘£ index ã« partial ã‚’åŸ‹ã‚è¾¼ã‚€
```
<%= render "star", question: question %>
```
ä¸€è¦§ã® each ã§å›ã£ã¦ã‚‹ question ã‚’ partial ã«æ¸¡ã™<br>
partial ã®ä¸­ã§ question.is_starred? ã‚’è¦‹ã¦è¡¨ç¤ºã‚’å¤‰ãˆã‚‰ã‚Œã‚‹

### â‘¤ Turbo Stream ã®è¿”ç­”ã‚’ä½œã‚‹
app/views/questions/toggle_star.turbo_stream.erb
```
<%= turbo_stream.replace dom_id(@question, :star) do %>
  <%= render "star", question: @question %>
<% end %>
```
ä½•ã‚’ã—ã¦ã‚‹ã®ã‹ï¼šã‚µãƒ¼ãƒãƒ¼å´ã‹ã‚‰ãƒ–ãƒ©ã‚¦ã‚¶ã«ã€ã€Œid ãŒ question_12_star ã®è¦ç´ ã‚’ã€ã“ã‚Œã«ç½®ãæ›ãˆã¦ã€ã¨ã„ã†å‘½ä»¤ã‚’è¿”ã—ã¦ã„ã‚‹<br>
replace ã¯ â€œå…¥ã‚Œæ›¿ãˆâ€ <br>
ãªãœ partial ã‚’ render ã—ã¦ã‚‹ã®ã‹ï¼šæ›´æ–°å¾Œã® @question.is_starred ã‚’è¦‹ã¦ã€
- â˜…ã‚’å‡ºã™
- â˜†ã‚’å‡ºã™

ã‚’åŒã˜ _star ã§æç”»ã§ãã‚‹