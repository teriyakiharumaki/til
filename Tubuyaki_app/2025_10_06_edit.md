# 編集機能の実装

## ✅ 行ったこと

- 編集機能の実装をした

## ①ルーティングの追加
```
# config/routes.rb
resources :posts, only: [:index, :new, :create, :show, :destroy, :edit, :update]
```

## ②コントローラーにedit/updateの追加
```
# app/controllers/posts_controller.rb
class PostsController < ApplicationController
  include ActionView::RecordIdentifier

  before_action :authenticate_user!, only: [:new, :create, :destroy, :edit, :update]
  before_action :set_post, only: [:show, :destroy, :edit, :update]
  before_action :authorize_owner!, only: [:destroy, :edit, :update]
  ~

  def show; end

  def edit; end

  def update
    if @post.update(post_params)
      redirect_to post_path(@post), notice: "更新しました"
    else
      flash.now[:alert] = "更新に失敗しました"
      render :edit, status: :unprocessable_entity
    end
  end

  def destroy
  ~

end
```

## ③フォームのパーシャルを編集
```
<!-- app/views/posts/_form.html.erb -->
<%= form_with model: post do |f| %>
  <div class="mb-3">
    <%= f.label :body, "本文", class: "form-label" %>
    <%= f.text_area :body, rows: 5, class: "form-control" %>
  </div>
  <%= f.submit (post.persisted? ? "更新する" : "投稿する"), class: "btn btn-primary" %>
<% end %>
```
```
<!-- app/views/posts/new.html.erb -->
<h1 class="mb-3">新規投稿</h1>
<%= render "form", post: @post %>
```
```
<!-- app/views/posts/edit.html.erb -->
<h1 class="mb-3">投稿を編集</h1>
<%= render "form", post: @post %>

<div class="mt-3">
  <%= link_to "戻る", post_path(@post), class: "btn btn-outline-secondary" %>
</div>
```

## ④ボタンの設置
どちらも削除の横に編集ボタンを実装<br>
配置は、いいねボタンを左端、編集ボタンと削除ボタンを右端に横並びになるように配置<br>
btn-outline-successで緑色のボタンとして実装

### 詳細ページ（show）
```
<div class="mt-2 pt-2 border-top d-flex justify-content-between align-items-center">
  <!-- 左：いいね -->
  <div>
    <%= render "posts/like_button", post: @post %>
  </div>

  <!-- 右：編集/削除（自分の投稿のみ） -->
  <div class="d-inline-flex gap-2">
    <% if logged_in? && @post.user_id == current_user.id %>
      <%= link_to "編集", edit_post_path(@post), class: "btn btn-outline-success btn-sm" %>
      <%= button_to "削除", post_path(@post), method: :delete,
            data: { turbo_confirm: "この投稿を削除します。よろしいですか？" },
            class: "btn btn-outline-danger btn-sm" %>
    <% end %>
  </div>
</div>
```

### 一覧ページ（index）
```
<div class="mt-2 pt-2 border-top position-relative z-3
            d-flex justify-content-between align-items-center">
  <!-- 左：いいね -->
  <div>
    <%= render "posts/like_button", post: post %>
  </div>

  <!-- 右：編集/削除（自分の投稿のみ表示） -->
  <div class="d-inline-flex gap-2">
    <% if logged_in? && post.user_id == current_user.id %>
      <%= link_to "編集", edit_post_path(post), class: "btn btn-outline-success btn-sm" %>
      <%= button_to "削除", post_path(post), method: :delete,
            data: { turbo_confirm: "この投稿を削除します。よろしいですか？" },
            class: "btn btn-outline-danger btn-sm" %>
    <% end %>
  </div>

  <!-- 背面の全体リンクはそのまま -->
  <%= link_to "", post_path(post), class: "stretched-link" %>
</div>
```

### レイアウトについてメモ
- justify-content-between で左右に分散配置
- gap-2 で編集/削除ボタンの間隔を調整
- 一覧は stretched-link を使っているので、このフッター行に position-relative z-3 を付与して前面に出しておく
